---
title: "Playing Style"
author: "Braden Churcher"
date: "27 June 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
g <- function(coef, t) coef %*% t^(0:3)
g(unlist(atp_serves[1,c("raw.x0.1","raw.x1.1","raw.x2.1","raw.x3.1")]),atp_serves$start.1[1])

fedvmurray <- atp_serves[atp_serves$matchid=="AO2016F_Djokovic_Murray",]
<<<<<<< HEAD

=======
table(atp_serves$server)
table(atp_serves$receiver)
>>>>>>> master
## XYZ Coordinates at different times ##

get_position<- function(coef_x,coef_y,coef_z,t){
  x<- g(coef_x,t)
  y<- g(coef_y,t)
  z<- g(coef_z,t)
data.frame(x=x,y=y,z=z,t=t)
  }
  postion_matrix <- function(coef_x,coef_y,coef_z,Start,End, Interval){
    times<- seq(start,end,by=interval)
    xyz<- lapply(times,get_position,coef_x=coef_x,coef_y=coef_y,coef_z=coef_z)
  do.call("rbind",xyz)
  }

# Test #
get_position(unlist(atp_serves[1,c("raw.x0.1","raw.x1.1","raw.x2.1","raw.x3.1")]), unlist(atp_serves[1,c("raw.y0.1","raw.y1.1","raw.y2.1","raw.y3.1")]),unlist(atp_serves[1,c("raw.z0.1","raw.z1.1","raw.z2.1","raw.z3.1")]),atp_serves$start.1[1])
```

## R Markdown
List of Serve Characteristics for feature selection:
1st vs 2nd Serve
Points in game? if reciever is on 40 or server is on 40. Does this differ?
Winning serves
Receivers Hand (R/L)

Types and key points:
Kick Serve:
  - Height of bounce (Z at )
      - Where was the Ball received?
  - Height over the net
  - Location ball is struck (is this different? To get top spin is it in a different spot)
  - Second serve characteristics
  - Speed
  - Spin
    - How do we calculate this?
  - Location in Service Box

Down the tee (Flat vs Spin/Kick)
  - Ball location in service box, depth looks important
  - Speed
  - Location ball is hit. For right handers in the ad court this could be back past the centre line on the      deuce side
Outwide (Flat vs Spin/Kick)
<<<<<<< HEAD


  

```{r}
## Roger Federer Receiving ##
fedr <- atp_serves %>% filter(receiver == "FEDERER")
ggplot(fedr, aes(x=center.x, y=center.y, color=factor(serve_classification))) + geom_point() + facet_wrap(~side)

## Serve location by player ##
ggplot(atp_serves_sub, aes(x=start.y, y=start.z, color=factor(server))) + geom_point()

## Most Aces ##
table(atp_serves$server, atp_serves$serve_classification== "0")

## Raonic Aces ##
Rao<- atp_serves %>% filter(server == "RAONIC")
ggplot(Rao, aes(x=start.y, y=start.z, color=factor(serve_classification == "0"))) + geom_point()
ggplot(Rao, aes(x=start.x, y=start.z, color=factor(serve_classification == "0"))) + geom_point() 
ggplot(Rao, aes(x=center.x, y=center.y, color=factor(serve_classification))) + geom_point() 
```

``` {r}
# Net Clearance Height by 1st and second serve #
#work out how to solve for x in arc one at x=0 for all serves#
ggplot(atp_serves, aes(x=center.x, y=net.clearance, color=factor(serve.x))) + geom_point() 
ggplot(atp_serves, aes(x=center.y, y=net.clearance, color=factor(serve.x))) + geom_point() 
```
Using the distance at which the ball bounced in the x direction, you can see the difference in serves. The first serve being clearly longer and slightly lower over the net. 
Using the width at which the ball bounced in the court you can see the how second serves are generally much safer. The height over the net though may not be exactly easy to determine if it is different, there does seem to be less serves at the lower end of the scale and more variation in the second serve. 
Interestingly you can see how the net slouches in the the middle of the court. 

```{r}
# Different points in games #
ggplot(atp_serves, aes(x=center.x, y=center.y, color=factor(serve.x))) + geom_point() + facet_wrap(~receiver_score)
=======


  

```{r}
## Roger Federer Receiving ##
fedr <- atp_serves %>% filter(receiver == "FEDERER")
ggplot(fedr, aes(x=center.x, y=center.y, color=factor(serve_classification))) + geom_point() + facet_wrap(~side)

## Serve location by player ##
ggplot(atp_serves_sub, aes(x=start.y, y=start.z, color=factor(server))) + geom_point()

## Most Aces ##
table(atp_serves$server, atp_serves$serve_classification== "0")

## Raonic Aces ##
Rao<- atp_serves %>% filter(server == "RAONIC")
ggplot(Rao, aes(x=start.y, y=start.z, color=factor(serve_classification == "0"))) + geom_point()
>>>>>>> master

```


You can also embed plots, for example:

```{r pressure, echo=FALSE}
## 

library(dplyr)
library(purrr)


get_location <- function(a, b, c, d, time) c(a, b, c, d) %*% time ^ (0:3)
get_location <- Vectorize(get_location)

locations <- function(a, b, c, d, start, end, interval = 0.05) {
  times <- seq(start, end, by = interval)
  data.frame(time = times, location = get_location(a, b, c, d, times))
}

temp <- atp_serves[1:3,] %>%
  by_row(~locations(.$raw.x0.1, .$raw.x1.1, .$raw.x2.1, .$raw.x3.1, .$start.1, .$start.1 + .$duration.arc1), .to = "xlocation")


temp$xlocation
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
